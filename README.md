# MatlabTFM

Included are Traction Force Microscopy (TFM) analysis using PIV for to solve for displacement and ANSYS Finite Element analysis for solving traction stress.

# Overview:

How does cells move, sense, adapt to the surrounding environment? By applying force to the environment (called extracellular matrix ECM). Cellular force, generated by interaction of actomyosin inside cell body, is transmitted through a network of cytoskeleton structure and deposited to the underlying/surrounding substrate via an assembly of integrin-ligand proteins (called focal adhesions). Can we quantify this amount of force to study the mechanical reponse to the different environment of different types of cell, different phenotypes in order to investigate their biological role or impairment in the biological function? Welcome to traction force microscopy! Here we try to quatify these cellular forces by capturing the deformation of the elastic substrate cause by cells and apply the theory of linear elastostatics to reconstruct the force applied from the map of deformation and elastic properties of substrate.

Schematic of procedure: preparation of TFM substrate => Culturing cells (w/wo treatment) on substrate => Captureing cell state (cell img - preferably fluorescence) => Captureing substrate deformation (loaded img) => Releasing cell from substrate (null img) => quantify deformation => Force reconstruction => Traction stress/force analysis.

Mathematical Framework:
Experimental Framework:
Solving analytically (Boussinesq solution to Green's function in Fourier space):
Solving by discretization (Finite Element - Boundary Element Method): 

# Usage

## Algorithm: 
	- Crop area of interest
	- Adjust loaded and null images to compensate for drifting effect
	- Compute cross correlation between null and loaded to get the displacement field u
	- Construct ECM model for FEM analysis (length,width,height and stiffness) and convert pixels to SI length
	- Perform FEM using ANSYS to get traction stress
	- Calulation of force, moment, energy from stress
 
	
## Module 1: Static TFM

 - TFM_Prep(): Gathering all information necessary for analysis including filtering image (bpass) and stage dedriftting (im_shift).
Requires no input parameters. This function asks for: 
	- the phase/bright field to crop ROI
	- a loaded image and a null image and attempt to dedrift 
	(ver2 included bpass filter - need to implement padarray for huge drift (>100px drift))
	- pixel to um ratio
	- gel information
	- ANSYS information
	- name of the save file
output: struct file containing images,gel,ansys information.
	
 - TFM_disp(in1): Get displacement
input: struct file created from TFM_Prep(). This function will call mpiv to perform cross correlation between loaded and null images.
By the end of PIV it will ask for bogus displacement removal. Look at the overlay image between loaded and null to verify true/false displacement detected.
(ver2 included smoothing, ver3 included auto remove displacement outside cell region and autosave result).
output: add piv information to the struct file.
***Note: TFM_disp and TFM_disp2 will not autosave the resultant displacement in the struct file. Manually save using save('filename.mat','-struct','ans').

 - TFM_solve(in1): Get ANSYS model and solving command
input: name of the output file. Contruct ANSYS model file for the ECM and create nodes for FEM solving.
output: ANSYS model/solver/log files and ANSYS call cmd (.bat) file. Execute .bat file to call ANSYS to solve for traction stress.
(ver2 include option to solve only for nodes inside ROI rather than the whole map).

 - TFM_Plot(in1): Plot result
input: name of the output file. Read ANSYS output. Plot result displacement and stressmap.
output: add stress, force result to struct file.
(ver2 include more calculated data and more plots. ver3 include reconstruction of displacement from stress and reaction force from contractile stress) 

## Module 2: Timelapse TFM

- TFMTL_Trace(argin1)
- TFMTL_Prep(argin1)
- TFMTL_disp(argin1)
- TFMTL_solve(argin1)
- TFMTL_Note(argin1)
- TFMTL_Plot(argin1)

*** Todo: Adapt code for parallel PIV to reduce time. Autotrace module for fluorescent cells. 
*** Possible for ANSYS parallel analysis??

## Module 3: Paranoma TFM

PanoTFM

*** Problem: Analysing images pre and post stitching does not yield similar result near edges

# Acknowledgement

Special thanks to:
	 - Professor Qi Wen - the original author of static TFM code https://www.wpi.edu/people/faculty/qwen
	 - Nobuhito Mori and Kuang-An Chang for MPIV module (especially for the implementation of MQD) 
	 http://www.oceanwave.jp/softwares/mpiv_doc/index.html
	 - Daniel Blair and Eric Dufresne for implementation of PT_IDL code with image filter in Matlab 
	 http://site.physics.georgetown.edu/matlab/
